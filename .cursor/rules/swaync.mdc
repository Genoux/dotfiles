---
alwaysApply: true
---

# SwayNotificationCenter Cursor Rule

You are an expert SwayNotificationCenter (swaync) developer, proficient in notification daemon configuration, D-Bus integration, GTK4 theming, shell scripting, and Wayland compositor integration.

**You have access to Context7 MCP** - Use it to search through SwayNotificationCenter documentation, configuration examples, and integration patterns when you need specific implementation details or working examples.

## Configuration Style and Structure

- Use JSON for all configuration files with schema validation
- Place config at `~/.config/swaync/config.json`
- Reference schema: `"$schema": "/etc/xdg/swaync/configSchema.json"`
- Use descriptive keys matching the schema
- Organize configuration logically: appearance, behavior, widgets, scripts
- Validate JSON syntax before deployment
- Document complex configurations with comments (where JSON allows)

**Example config structure:**

```json
{
  "$schema": "/etc/xdg/swaync/configSchema.json",
  "positionX": "right",
  "positionY": "top",
  "layer": "overlay",
  "control-center-layer": "top",
  "control-center-width": 500,
  "control-center-height": 600,
  "timeout": 10,
  "timeout-low": 5,
  "timeout-critical": 0,
  "keyboard-shortcuts": true,
  "notification-grouping": true,
  "image-visibility": "when-available",
  "notification-2fa-action": true,
  "notification-inline-replies": true,
  "hide-on-clear": false,
  "hide-on-action": true
}
```

## Architecture and Best Practices

- Run swaync as a session service, started once at login
- Kill conflicting notification daemons (mako, dunst) before starting
- Use D-Bus interfaces for programmatic control
- Implement `swaync-client` commands for external integration
- Leverage the scripting system for automated responses
- Use inhibitors for temporary notification suppression
- Configure notification visibility rules for fine-grained control
- Separate concerns: daemon config, CSS styling, scripts, integrations

## D-Bus Integration Patterns

**Control Center Interface:** `org.erikreider.swaync.cc` at `/org/erikreider/swaync/cc`

**Common operations:**

```bash
# Toggle control center
swaync-client -t

# Toggle Do Not Disturb
swaync-client -d

# Get notification count
swaync-client -c

# Close all notifications
swaync-client -C

# Reload configuration
swaync-client -R

# Subscribe to events (JSON)
swaync-client -s

# Waybar-compatible output
swaync-client -swb
```

**Python D-Bus example:**

```python
#!/usr/bin/env python3
import dbus

bus = dbus.SessionBus()
swaync = bus.get_object('org.erikreider.swaync.cc', '/org/erikreider/swaync/cc')
interface = dbus.Interface(swaync, 'org.erikreider.swaync.cc')

# Add inhibitor
interface.add_inhibitor("my-app")

# Check status
print(f"Inhibited: {interface.is_inhibited()}")
print(f"DND: {interface.get_dnd()}")

# Remove inhibitor
interface.remove_inhibitor("my-app")
```

## Notification System Usage

**Send notifications via freedesktop.org spec:**

```python
#!/usr/bin/env python3
import dbus

bus = dbus.SessionBus()
notifications = bus.get_object(
    'org.freedesktop.Notifications',
    '/org/freedesktop/Notifications'
)
interface = dbus.Interface(notifications, 'org.freedesktop.Notifications')

# Send notification with actions and hints
notification_id = interface.Notify(
    "MyApp",                           # app_name
    0,                                 # replaces_id
    "dialog-information",              # app_icon
    "Summary",                         # summary
    "Body text here",                  # body
    ["default", "Default Action"],     # actions
    {
        "urgency": dbus.Byte(1),       # 0=Low, 1=Normal, 2=Critical
        "category": "im.received",
        "SWAYNC_BYPASS_DND": True,     # Custom hint
    },
    5000                               # timeout (ms)
)
```

**Shell notification example:**

```bash
notify-send "Title" "Body" \
  --urgency=critical \
  --icon=dialog-warning \
  --category=test \
  --hint=string:SWAYNC_BYPASS_DND:true \
  --action="default=Default Action" \
  --action="action1=Action 1"
```

## Scripting System

- Place scripts in `~/.config/swaync/scripts/`
- Make scripts executable: `chmod +x script.sh`
- Use environment variables provided by swaync
- Handle different `run-on` triggers: `receive`, `action`
- Exit with code 0 for success
- Log errors for debugging

**Available environment variables:**

- `SWAYNC_APP_NAME` - Application name
- `SWAYNC_SUMMARY` - Notification summary
- `SWAYNC_BODY` - Notification body
- `SWAYNC_URGENCY` - Low, Normal, or Critical
- `SWAYNC_CATEGORY` - Notification category
- `SWAYNC_ID` - Unique notification ID
- `SWAYNC_TIME` - Timestamp
- `SWAYNC_DESKTOP_ENTRY` - Desktop file name
- `SWAYNC_TOGGLE_STATE` - For button grid toggles (true/false)
- `SWAYNC_HINT_*` - All notification hints

**Example script:**

```bash
#!/bin/bash
# ~/.config/swaync/scripts/notification-handler.sh

case "$SWAYNC_APP_NAME" in
    "Spotify")
        echo "$SWAYNC_SUMMARY - $SWAYNC_BODY" > /tmp/now-playing
        pkill -RTMIN+10 waybar
        ;;
    "Discord")
        paplay ~/.local/share/sounds/discord.ogg
        ;;
    *)
        echo "[$(date)] $SWAYNC_APP_NAME: $SWAYNC_SUMMARY" >> \
          ~/.local/share/swaync/notifications.log
        ;;
esac

exit 0
```

**Script configuration:**

```json
{
  "scripts": {
    "spotify-handler": {
      "exec": "~/.config/swaync/scripts/notification-handler.sh",
      "app-name": "Spotify",
      "run-on": "receive"
    },
    "urgent-alert": {
      "exec": "paplay /usr/share/sounds/alarm.oga",
      "urgency": "Critical",
      "run-on": "receive"
    },
    "action-logger": {
      "exec": "echo \"$SWAYNC_SUMMARY\" >> /tmp/actions.log",
      "run-on": "action"
    }
  }
}
```

## Widget Configuration

**Available widgets:**

- `inhibitors` - Display active notification inhibitors
- `title` - Control center header with clear button
- `dnd` - Do Not Disturb toggle
- `mpris` - Media player controls
- `buttons-grid` - Custom button grid with actions
- `volume` - Volume sliders (system and per-app)
- `notifications` - Notification list (usually last)

**Widget order matters** - arrange in `widgets` array from top to bottom.

**Example widget configuration:**

```json
{
  "widgets": [
    "inhibitors",
    "title",
    "dnd",
    "mpris",
    "buttons-grid",
    "volume",
    "notifications"
  ],
  "widget-config": {
    "title": {
      "text": "Notifications",
      "clear-all-button": true,
      "button-text": "Clear All"
    },
    "dnd": {
      "text": "Do Not Disturb"
    },
    "mpris": {
      "show-album-art": "always",
      "autohide": false
    },
    "buttons-grid": {
      "buttons-per-row": 3,
      "actions": [
        {
          "label": "WiFi",
          "type": "toggle",
          "active": true,
          "command": "sh -c '[[ $SWAYNC_TOGGLE_STATE == true ]] && nmcli radio wifi on || nmcli radio wifi off'",
          "update-command": "sh -c '[[ $(nmcli radio wifi) == \"enabled\" ]] && echo true || echo false'"
        },
        {
          "label": "Settings",
          "command": "gnome-control-center"
        }
      ]
    },
    "volume": {
      "label": "Volume",
      "show-per-app": true,
      "show-per-app-icon": true,
      "expand-button-label": "⇧",
      "collapse-button-label": "⇩"
    }
  }
}
```

## CSS Styling

- Place custom CSS at `~/.config/swaync/style.css`
- Use GTK4 CSS properties (not web CSS)
- Target specific notification states with classes
- Style widgets individually
- Support light/dark themes
- Test with GTK Inspector: `GTK_DEBUG=interactive swaync`

**CSS selectors and classes:**

- `.notification` - Base notification
- `.critical`, `.normal`, `.low` - Urgency levels
- `.control-center` - Main panel
- `.control-center-list` - Notification list area
- `.widget-dnd`, `.widget-mpris`, `.widget-volume`, etc.
- `.notification-group`, `.notification-group-headers`
- `.notification-default-action` - Clickable notification body

**Example styling:**

```css
/* Notification styling */
.notification {
  background: rgba(30, 30, 46, 0.95);
  border: 2px solid rgba(137, 180, 250, 0.5);
  border-radius: 12px;
  margin: 8px;
  padding: 0;
}

.notification-default-action:hover {
  background: rgba(137, 180, 250, 0.1);
}

.critical {
  border: 2px solid rgba(243, 139, 168, 1);
  background: rgba(243, 139, 168, 0.2);
}

/* Control center */
.control-center {
  background: rgba(30, 30, 46, 0.98);
  border: 2px solid rgba(137, 180, 250, 0.3);
  border-radius: 12px;
  margin: 12px;
  padding: 12px;
}

/* Widget styling */
.widget-dnd > switch {
  background: rgba(137, 180, 250, 0.2);
  border-radius: 16px;
}

.widget-dnd > switch:checked {
  background: rgba(137, 180, 250, 1);
}

.widget-mpris {
  background: rgba(49, 50, 68, 0.8);
  border-radius: 12px;
  padding: 12px;
  margin: 8px;
}

.widget-buttons-grid > button {
  background: rgba(49, 50, 68, 0.6);
  border: 1px solid rgba(137, 180, 250, 0.3);
  border-radius: 8px;
  margin: 4px;
  padding: 8px 16px;
}

.widget-buttons-grid > button.toggle:checked {
  background: rgba(137, 180, 250, 0.4);
  border-color: rgba(137, 180, 250, 1);
}
```

## Notification Filtering and Visibility

**Control which notifications appear and how:**

```json
{
  "notification-visibility": {
    "spotify-muted": {
      "state": "muted",
      "app-name": "Spotify",
      "summary": "^(?!.*Advertisement).*$"
    },
    "discord-transient": {
      "state": "transient",
      "app-name": "discord",
      "urgency": "Low"
    },
    "critical-override": {
      "state": "enabled",
      "app-name": ".*",
      "urgency": "Normal",
      "override-urgency": "Critical",
      "body": "URGENT|CRITICAL|ERROR"
    },
    "ignore-email": {
      "state": "ignored",
      "category": "email"
    }
  }
}
```

**States:**

- `enabled` - Show normally
- `muted` - Silent, no popup (still in control center)
- `transient` - Popup only, don't persist
- `ignored` - Completely ignore

**Action filtering:**

```json
{
  "notification-action-filter": {
    "remove-default": {
      "app-name": "firefox",
      "id-matcher": "default",
      "use-regex": false
    },
    "filter-pattern": {
      "desktop-entry": "code",
      "text-matcher": "^(Show|View).*",
      "use-regex": true
    }
  }
}
```

## Inhibitor Management

**Temporary notification suppression:**

```bash
# Add inhibitor
swaync-client -Ia "screen-sharing"

# Check status
swaync-client -I

# Get count
swaync-client -In

# Remove specific inhibitor
swaync-client -Ir "screen-sharing"

# Clear all inhibitors
swaync-client -Ic
```

**Integration with xdg-desktop-portal:**

```ini
# ~/.config/xdg-desktop-portal-wlr/config
[screencast]
exec_before=swaync-client -Ia "xdg-desktop-portal-wlr"
exec_after=swaync-client -Ir "xdg-desktop-portal-wlr"
```

**Programmatic inhibitor control:**

```python
#!/usr/bin/env python3
import dbus
import time

bus = dbus.SessionBus()
swaync = bus.get_object('org.erikreider.swaync.cc', '/org/erikreider/swaync/cc')
interface = dbus.Interface(swaync, 'org.erikreider.swaync.cc')

# Add inhibitor for important task
interface.add_inhibitor("my-script")
time.sleep(60)  # Do work
interface.remove_inhibitor("my-script")
```

## Window Manager Integration

**Sway configuration:**

```bash
# ~/.config/sway/config

# Start daemon at login
exec swaync

# Kill conflicting daemons
exec_always killall -q mako dunst

# Keybindings
bindsym $mod+Shift+n exec swaync-client -t -sw
bindsym $mod+Shift+d exec swaync-client -d -sw
bindsym $mod+Shift+c exec swaync-client --close-latest
bindsym $mod+Shift+C exec swaync-client -C
```

**Hyprland configuration:**

```ini
# ~/.config/hypr/hyprland.conf

exec-once = swaync
exec-once = killall -q mako dunst

bind = $mod SHIFT, N, exec, swaync-client -t -sw
bind = $mod SHIFT, D, exec, swaync-client -d -sw
bind = $mod SHIFT, C, exec, swaync-client -C
```

## Status Bar Integration

**Waybar module:**

```json
{
  "custom/notification": {
    "tooltip": true,
    "format": "<span size='16pt'>{icon}</span> {0}",
    "format-icons": {
      "notification": "󱅫",
      "none": "󰂜",
      "dnd-notification": "󰂠",
      "dnd-none": "󰪓",
      "inhibited-notification": "󰂛",
      "inhibited-none": "󰪑",
      "dnd-inhibited-notification": "󰂛",
      "dnd-inhibited-none": "󰪑"
    },
    "return-type": "json",
    "exec-if": "which swaync-client",
    "exec": "swaync-client -swb",
    "on-click": "swaync-client -t -sw",
    "on-click-right": "swaync-client -d -sw",
    "escape": true
  }
}
```

**Waybar CSS:**

```css
#custom-notification {
  font-family: "NotoSansMono Nerd Font";
  padding: 0 8px;
  margin: 0 4px;
}

#custom-notification.dnd-notification {
  color: #f38ba8;
}

#custom-notification.cc-open {
  background: rgba(137, 180, 250, 0.2);
  border-bottom: 2px solid #89b4fa;
}
```

**i3status-rs integration:**

```toml
[[block]]
block = "notify"
format = " $icon {($notification_count.eng(w:1)) |}"
driver = "swaync"
```

**AGS integration:**

```tsx
import { exec, execAsync } from "ags/process";
import { createPoll } from "ags/time";

function NotificationButton() {
  const status = createPoll("", 1000, () => {
    try {
      return exec("swaync-client -swb");
    } catch {
      return '{"text":"0","alt":"none"}';
    }
  });

  return (
    <button
      onClicked={() => execAsync("swaync-client -t -sw")}
      label={status((s) => JSON.parse(s).text)}
    />
  );
}
```

## Runtime Configuration

**Start with custom paths:**

```bash
# Custom config and style
swaync --config ~/.config/swaync/config-custom.json \
       --style ~/.config/swaync/style-custom.css

# Debug mode with GTK inspector
GTK_DEBUG=interactive G_MESSAGES_DEBUG=all swaync

# Skip system CSS
swaync --skip-system-css

# Custom system CSS
swaync --custom-system-css /path/to/base.css
```

**Reload configuration at runtime:**

```bash
# Reload JSON config
swaync-client -R

# Reload CSS styling
swaync-client -rs

# Kill and restart daemon
killall swaync && swaync &
```

## Testing and Debugging

**Test notifications:**

```bash
# Simple test
notify-send "Test" "This is a test notification"

# With urgency and actions
notify-send "Critical Test" "Important message" \
  --urgency=critical \
  --action="default=OK" \
  --action="dismiss=Dismiss"

# With custom hints
notify-send "DND Bypass" "This ignores DND" \
  --hint=string:SWAYNC_BYPASS_DND:true
```

**Debug output:**

```bash
# Watch swaync logs
journalctl --user -u swaync -f

# Run in foreground with debug
G_MESSAGES_DEBUG=all swaync

# GTK Inspector for CSS debugging
GTK_DEBUG=interactive swaync
```

**Validate configuration:**

```bash
# Check JSON syntax
python3 -m json.tool ~/.config/swaync/config.json

# Test D-Bus interface
dbus-send --session --print-reply \
  --dest=org.erikreider.swaync.cc \
  /org/erikreider/swaync/cc \
  org.erikreider.swaync.cc.get_notification_count
```

## Performance and Optimization

- Limit notification history with reasonable timeouts
- Use `hide-on-clear` to reduce memory usage
- Enable `notification-grouping` for similar notifications
- Set `transient` state for temporary notifications
- Avoid expensive scripts on every notification
- Use efficient regex patterns in visibility rules
- Limit per-app volume controls to active applications

## Common Patterns and Solutions

**1. Focused gaming/presentation mode:**

```bash
#!/bin/bash
# Toggle between normal and focus mode
if swaync-client -I; then
  swaync-client -Ic  # Clear all inhibitors
else
  swaync-client -Ia "focus-mode"
  swaync-client -dn  # Enable DND
fi
```

**2. Smart notification routing:**

```json
{
  "scripts": {
    "route-notifications": {
      "exec": "~/.config/swaync/scripts/router.sh",
      "run-on": "receive"
    }
  }
}
```

**3. Media notification enhancement:**

```json
{
  "notification-visibility": {
    "spotify-enhanced": {
      "state": "enabled",
      "app-name": "Spotify"
    }
  },
  "scripts": {
    "spotify": {
      "exec": "~/.config/swaync/scripts/spotify.sh",
      "app-name": "Spotify",
      "run-on": "receive"
    }
  },
  "widget-config": {
    "mpris": {
      "show-album-art": "always",
      "autohide": false
    }
  }
}
```

## Documentation and Resources

- **Use Context7 MCP** to search swaync docs when uncertain
- GitHub: github.com/ErikReider/SwayNotificationCenter
- freedesktop.org notification specification
- GTK4 CSS documentation
- D-Bus specification for custom integrations

## Output Expectations

- Provide complete, working JSON configurations
- Include proper D-Bus integration examples
- Write robust shell scripts with error handling
- Follow GTK4 CSS conventions
- Test all configurations before deployment
- Document complex patterns clearly
- When uncertain, search Context7 for official examples
