# ================================
# HYPRLAND ENVIRONMENT CONFIG
# ================================
# Environment variables for Wayland, NVIDIA, and application compatibility

# ================================
# WAYLAND & DISPLAY SERVER
# ================================
env = WAYLAND_DISPLAY,wayland-1
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland

env = XDG_SESSION_CLASS,user

env = GTK_USE_PORTAL,0
env = QT_WAYLAND_DISABLE_SELECTION,1

# ================================
# PATH CONFIGURATION
# ================================
# Add ~/.local/bin to PATH for scripts
env = PATH,$HOME/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/bin:/var/lib/flatpak/exports/bin:/usr/lib/jvm/default/bin:/usr/bin/site_perl:/usr/bin/vendor_perl:/usr/bin/core_perl

# ================================
# NVIDIA SPECIFIC SETTINGS
# ================================
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = LIBVA_DRIVER_NAME,nvidia
env = NVIDIA_WAYLAND_ENABLE_DRM_KMS,1
env = __GL_GSYNC_ALLOWED,0
env = __GL_VRR_ALLOWED,0

# NVIDIA suspend/resume fixes
env = __GL_MaxFramesAllowed,1
env = __GL_SYNC_TO_VBLANK,0
env = NVIDIA_FORCE_COMPOSITION_PIPELINE,1
# Additional suspend/resume stability
env = __GL_THREADED_OPTIMIZATIONS,0
env = KWIN_DRM_DEVICES,/dev/dri/card2

# ================================
# WAYLAND BACKEND SETTINGS
# ================================
env = CLUTTER_BACKEND,wayland
env = GDK_BACKEND,wayland,x11
#env = SDL_VIDEODRIVER,wayland,x11, windows

# WLR (wlroots) settings - adjusted for NVIDIA stability
env = WLR_NO_HARDWARE_CURSORS,1
# Removed WLR_DRM_NO_ATOMIC as it can cause suspend issues
# env = WLR_DRM_NO_ATOMIC,1
env = WLR_RENDERER_ALLOW_SOFTWARE,1
# Use ONLY NVIDIA GPU (card2) to prevent dual-GPU suspend/resume crashes
env = WLR_DRM_DEVICES,/dev/dri/card2
# Force render on NVIDIA
env = WLR_RENDERER,vulkan
env = WLR_RENDER_DRM_DEVICE,/dev/dri/renderD129

# ================================
# QT APPLICATION SETTINGS
# ================================
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_QPA_PLATFORM,wayland;xcb
env = QT_QPA_PLATFORMTHEME,gtk3
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1

# ================================
# GTK APPLICATION SETTINGS
# ================================
env = GTK_IM_MODULE,wayland
env = GTK_CSD,0
env = HL_INITIAL_WORKSPACE_TOKEN,0
env = GDK_DECORATION_LAYOUT,

# ================================
# BROWSER SETTINGS
# ================================
# Firefox optimizations
env = MOZ_DISABLE_RDD_SANDBOX,1
env = MOZ_ENABLE_WAYLAND,1
env = MOZ_WEBRENDER,1
env = MOZ_GTK_TITLEBAR_DECORATION,client

# ================================
# ELECTRON APP COMPATIBILITY
# ================================
env = ELECTRON_OZONE_PLATFORM_HINT,wayland
env = ELECTRON_ENABLE_WAYLAND,1
env = NIXOS_OZONE_WL,1
env = ELECTRON_DISABLE_FRAME,1
env = ELECTRON_DISABLE_DEFAULT_MENU_BAR,1

# ================================
# THEME & CURSOR SETTINGS
# ================================
#env = GTK_THEME,WhiteSur-Dark
#env = GTK4_THEME,WhiteSur-Dark
#env = XCURSOR_THEME,MacTahoe
env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE,24
env = XCURSOR_PATH,$HOME/.local/share/icons:$HOME/.icons:/usr/share/icons:/usr/share/pixmaps

# ================================
# APPLICATION SPECIFIC
# ================================
env = TERMINAL,kitty
# Java AWT
env = JAVA_AWT_WM_NONREPARENTING,1
# GTK/QT scaling - set to 1 for 1080p desktop
env = GDK_SCALE,1
env = QT_SCALE_FACTOR,1

# ================================
# GAMING SETTINGS
# ================================

# Gaming performance
env = WINE_CPU_TOPOLOGY,4:2
env = DXVK_ASYNC,1
env = DXVK_STATE_CACHE,1
env = VKFFT_BACKEND,2

# Mesa/graphics optimizations
env = MESA_SHADER_CACHE_DISABLE,false
env = RADV_PERFTEST,gpl,nggc,sam