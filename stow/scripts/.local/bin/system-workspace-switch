#!/bin/bash

# Auto-close special workspace when switching to regular workspaces
# Usage: system-workspace-switch <workspace_number>

[ $# -eq 0 ] && { echo "Usage: $0 <workspace_number>"; exit 1; }

WORKSPACE=$1

# Switch to target workspace FIRST (single atomic operation)
# This prevents rapid focus changes that overwhelm AGS
hyprctl dispatch workspace "$WORKSPACE"

# THEN close special workspace if it was visible
# This happens after focus is already on the target workspace
SPECIAL_VISIBLE=$(hyprctl monitors -j | jq -r '.[].specialWorkspace.name' | grep -v '^$')

if [ -n "$SPECIAL_VISIBLE" ]; then
    SPECIAL_NAME=${SPECIAL_VISIBLE#special:}
    [ "$SPECIAL_NAME" = "special" ] && hyprctl dispatch togglespecialworkspace || hyprctl dispatch togglespecialworkspace "$SPECIAL_NAME"
fi