#!/bin/bash
# Display weather - TUI style, no shell prompt
# Always open a new kitty window with specific size

# If we're already in display mode (env var set), just run the display
if [ "$WEATHER_DISPLAY" = "1" ]; then
    # Clear screen, hide cursor, and position at top
    tput clear
    tput civis
    tput home

    # Set environment variables to fix EGL/GPU issues
    export LIBGL_ALWAYS_SOFTWARE=1
    export __GL_THREADED_OPTIMIZATIONS=0
    export MESA_GL_VERSION_OVERRIDE=3.3

    # Run wego and ensure we're at the top
    wego
    tput home

    # Wait for any keypress (silent, no echo)
    stty -echo
    read -n 1 -s
    stty echo

    # Show cursor and exit cleanly
    tput cnorm
    exit 0
fi

# Always launch kitty (will create new window even if kitty is running)
exec kitty --class=weather-clear --title=weather \
    -o initial_window_width=80c \
    -o initial_window_height=24c \
    env WEATHER_DISPLAY=1 "$0"