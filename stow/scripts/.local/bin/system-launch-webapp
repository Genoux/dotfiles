#!/bin/bash

if [[ $# -lt 1 ]]; then
    echo "Usage: $0 <url> [additional_args...]"
    exit 1
fi

url="$1"

browser=$(xdg-settings get default-web-browser)

flags=""
if [[ -f ~/.config/electron-flags.conf ]]; then
    flags="$flags $(grep -v '^#' ~/.config/electron-flags.conf | tr '\n' ' ')"
fi

for dir in "$HOME/.local/share/applications" "$HOME/.nix-profile/share/applications" "/usr/share/applications"; do
    if [[ -f "$dir/$browser" ]]; then
        browser_path=$(sed -n 's/^Exec=\([^ ]*\).*/\1/p' "$dir/$browser" | head -1)
        break
    fi
done

[[ -z "$browser_path" ]] && { echo "Error: Browser not found" >&2; exit 1; }

setsid -f "$browser_path" $flags --app="$url" "${@:2}" >/dev/null 2>&1